# ch04 오류

코드가 실행되는 환경은 불완전하다. 사용자가 잘못된 입력을 제공하고, 외부 시스템이 다운되며, 자신이 작성한 코드와 다른 개발자가 작성한 코드가 종종 버그를 가질 수 있다. 이런 점을 감안할 때 오류는 불가피하다. 모든 것이 잘못될 수 있고 잘못될 것이기 대문에 오류 사례를 신중하게 생각하지 않고는 견고하고 신뢰성 높은 코드를 작성할 수 없다.

## 4.1 복구 가능성

### 4.1.1 복구 가능한 오류

- 네트워크 오류 : 자신의 코드가 의존하는 서비스에 연결할 수 없는 경우 몇 초 동안 기다렸다가 다시 시도하거나, 그 코드가 사용자의 장치에서 실행되는 경우라면 사용자에게 네트워크 연결을 확인하도록 요청하는것이 최상이다.
- 중요하지 않은 작업 오류
### 4.1.2 복구할 수 없는 오류

- 코드와 함께 추가되어야 하는 리스소가 없다.
- 다음 예외 같이 어떤 코드가 다른 코드를 잘못 사용한다.
	- 잘못된 입력 인수로 호출
	- 일부 필요한 상태를 사전에 초기화하지 않음

### 4.1.3 호출하는 쪽에서만 오류 복구 가능 여부를 알 때가 많다.

- 오류로부터 복구하기를 호출하는 쪽에서 원하는가?
- 만약 그렇다면 오류를 처리할 필요가 있다는 것을 호출하는 쪽에서는 어떻게 알 수 있을까?

- 함수가 어디서 호출될지 그리고 호출 시 제공되는 값이 어디서 올지 정확한(완전한) 지식이 없다.
- 코드가 미래에 재사용될 가능성이 아주 희박하다. 재사용이 된다면 코드가 어디에서 호출되고 값이 어디서 오는지에 대한 가정이 의미 없어질 수 있음을 뜻한다.

### 4.1.4 호출하는 쪽에서 복구하고자 하는 오류에 대해 인지하도록 하라

## 4.2 견고성 vs 실패

오류가 발생할 때, 다음 중 하나를 선택해야 한다.

- 실패, 더 높은 코드 계층이 오류를 처리하게 하거나 전체 프로그램의 작동을 멈추게 한다.
- 오류를 처리하고 계속 진행한다.

### 4.2.1 신속하게 실패하라

### 4.2.2 요란하게 실패하라

요란한 실패는 간단히 말하자면 오류가 발생하는데도 불구하고 아무도 모르는 상황을 막고자 하는 것이다. 이를 위한 가장 명확한(그리고 강압적인) 방법은 예외(또는 이와 유사한 것)를 발생해 프로그램이 중단되게 하는 것이다.

코드가 실패할 때 신속하고, 요란하게 오류를 나타내면 개발 도중이나 테스트하는 동안에 버그가 발견될 가능성이 크다. 그렇지 않더라도 배포된 후에 오류 보고를 보기 시작할 것이고 보고 내용으로부터 버그가 발생한 위치를 정확히 알 수 있다는 이점이 있다.

### 4.2.3 복구 가능성의 범위

일반적으로 소프트웨어를 견고하게 작성하는 것이 좋다. 한 번의 잘못된 요청으로 인해 전체 서버의 동작이 멈추는 것은 바람직하지 않다. 그러나 오류를 알아차리지못한 채 시스템이 계속 동작하지 않도록 하는 것 또한 중요하기 때문에 코드가 요란하게 실패해야 한다.

이에 대한 해결책은 오류가 발견되면 개발자가 이를 알아차릴 수 있도록 프로그래밍 오류를 기록하고 모니터링하는 것이다.

### 4.2.4 오류를 숨기지 않음

- 호출하는 쪽에서 복구하고자 할 수도 있는 오류를 숨기면, 호출하는 쪽에서 오류로부터 복구할 수 있는 기회를 없애는 것이다.
- 복구할 수 없는 오류를 숨기면 프로그래밍 오류가 감춰진다.
- 이 두 경우 모두 에러가 발생하면 일반적으로 호출하는 쪽에서 예측한 대로 코드가 실행되지 않는다는 것을 의미한다.

- 기본값 반환
- 널 객체 패턴
- 아무것도 하지 않음
## 4.3 오류 전달 방법

오류가 발생하면 일반적으로 더 높은 계층으로 오류를 알려야 한다. 오류로부터 복구할 수 없는 경우 이는 일반적으로 프로그래밍의 훨씬 더 높은 계층에서 실행을 중지하고, 오류를 기록하거나 전체 프로그램의 실행을 종료하는 것을 의미한다.

- 명시적 방법
- 암시적 방법

- 요약 : 예외
- 명시적 방법: 검사 예외
	- 검사 예외를 사용한 오류 전달
	- 검사 예외 처리
- 암시적 방법: 비검사 예외
	- 비검사 예외를 사용한 오류 전달
	- 비검사 예외 처리

- 명시적 방법: 널값이 가능한 반환 유형
	- 널값을 이용한 오류 전달
	- 널값 처리
- 명시적 방법: 리절트 반환 유형
	- 리절트 유형을 이용한 전달
- 명시적 방법: 아웃컴 반환 유형
	- 아웃컴을 이용한 오류 전달
	- 아웃컴 처리
	- 아웃컴이 무시되지 않도록 보장
- 암시적 방법: 프로미스 또는 퓨처
	- 프로미스를 이용한 전달
	- 프로미스 처리
	- 왜 프로미스는 암묵적인 오류 전달 기법인가
	- 프로미스를 명시적으로 만들기
	- 암시적 방법: 매직값 반환
	- 

## 4.4 복구할 수 없는 오류 전달

- 비검사 예외를 발생
- 프로그램이 패닉`panic`이 되도록 (패닉을 지원하는 언어를 사용하는 경우)
- 체크나 어서션의 사용

## 4.5 호출하는 쪽에서 복구하기를 원할 수 도 있는 오류의 전달

- 비검사 예외를 사용해야 한다는 주장
	- 코드 구조 개선
	- 개발자들이 무엇을 할 것인지에 대해서 실용적이어야 함
- 명시적 기법을 사용해야 한다는 주장
	- 매끄러운 오류 처리
	- 실수로 오류를 무시할 수 없다.
	- 개발자들이 무엇을 할 것인지에 대해서 실용적이어야 함
- 필자의 의견: 명시적 방식을 사용하라
- 컴파일러 경고를 무시하지 말라

## 요약

- 오류에는 크게 두 가지 종류가 있다.
	- 시스템이 복구할 수 있는 오류
	- 시스템이 복구할 수 없는 오류
- 해당 코드에 의해 생성된 오류로부터 복구할 수 있는지 여부를 해당 코드를 호출하는 쪽에서만 알 수 있는 경우가 많다.
- 에러가 발생하면 신속하게 실패하는 것이 좋고, 에러를 복구할 수 없는 경우에는 요란하게 실패하는 것이 바람직하다.
- 오류를 숨기는 것은 바람직하지 않을 때가 많으며, 오류를 발생했다는 신호를 보내는 것이 바람직하다.
- 오류 전달 기법은 두 가지 범주로 나눌 수 있다.
	- 명시적 방법: 코드 계약의 명확한 부분, 호출하는 쪽에서는 오류가 발생할 수 있음을 인지한다.
	- 임시적 방법: 코드 계약의 세부 조항을 통해 오류에 대한 설명이 제공되거나 전혀 설명이 없을 수도 있다. 오류가 발생할 수 있다는 것을 호출하는 쪽에서 반드시 인지하는 것은 아니다.
- 복구할 수 없는 오류에 대해서는 암시적 오류 전달 기법을 사용해야 한다.
- 잠재적으로 복구할 수 없는 오류에 대해서는
	- 명시적 혹은 암시적 기법 중 어느 것을 사용할지에 대해서는 개발자들 사이에서도 일치되는 의견이 없다.
	- 필자의 의견으로는 명시적인 기법이 사용되어야 한다.
- 컴파일러 경고는 종종 코드에 문제가 있을 때 이에 대해 표시해준다. 이 경고에 주의를 기울이는 것이 바람직하다.




